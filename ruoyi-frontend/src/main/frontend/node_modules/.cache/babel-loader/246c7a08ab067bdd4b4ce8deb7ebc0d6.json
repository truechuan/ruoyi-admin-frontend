{"remainingRequest":"/Users/chenchuan/Documents/diandabai/diandabai/ruoyi-frontend/src/main/frontend/node_modules/thread-loader/dist/cjs.js!/Users/chenchuan/Documents/diandabai/diandabai/ruoyi-frontend/src/main/frontend/node_modules/babel-loader/lib/index.js!/Users/chenchuan/Documents/diandabai/diandabai/ruoyi-frontend/src/main/frontend/src/permission.js","dependencies":[{"path":"/Users/chenchuan/Documents/diandabai/diandabai/ruoyi-frontend/src/main/frontend/src/permission.js","mtime":1578710388000},{"path":"/Users/chenchuan/Documents/diandabai/diandabai/ruoyi-frontend/src/main/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenchuan/Documents/diandabai/diandabai/ruoyi-frontend/src/main/frontend/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chenchuan/Documents/diandabai/diandabai/ruoyi-frontend/src/main/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/chenchuan/Documents/diandabai/diandabai/ruoyi-frontend/src/main/frontend/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread2\";\nimport router from \"./router\";\nimport store from \"./store\";\nimport { Message } from 'element-ui';\nimport NProgress from 'nprogress';\nimport 'nprogress/nprogress.css';\nimport { getToken } from '@/utils/auth';\nNProgress.configure({\n  showSpinner: false\n});\nvar whiteList = ['/login', '/auth-redirect', '/bind', '/register'];\nrouter.beforeEach(function (to, from, next) {\n  NProgress.start();\n\n  if (getToken()) {\n    /* has token*/\n    if (to.path === '/login') {\n      next({\n        path: '/'\n      });\n      NProgress.done();\n    } else {\n      if (store.getters.roles.length === 0) {\n        // 判断当前用户是否已拉取完user_info信息\n        store.dispatch('GetInfo').then(function (res) {\n          // 拉取user_info\n          var roles = res.roles;\n          store.dispatch('GenerateRoutes', {\n            roles: roles\n          }).then(function (accessRoutes) {\n            // 测试 默认静态页面\n            // store.dispatch('permission/generateRoutes', { roles }).then(accessRoutes => {\n            // 根据roles权限生成可访问的路由表\n            router.addRoutes(accessRoutes); // 动态添加可访问路由表\n\n            next(_objectSpread({}, to, {\n              replace: true\n            })); // hack方法 确保addRoutes已完成\n          });\n        }).catch(function (err) {\n          store.dispatch('FedLogOut').then(function () {\n            Message.error(err);\n            next({\n              path: '/'\n            });\n          });\n        });\n      } else {\n        next(); // 没有动态改变权限的需求可直接next() 删除下方权限判断 ↓\n        // if (hasPermission(store.getters.roles, to.meta.roles)) {\n        //   next()\n        // } else {\n        //   next({ path: '/401', replace: true, query: { noGoBack: true }})\n        // }\n        // 可删 ↑\n      }\n    }\n  } else {\n    // 没有token\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 在免登录白名单，直接进入\n      next();\n    } else {\n      next(\"/login?redirect=\".concat(to.path)); // 否则全部重定向到登录页\n\n      NProgress.done();\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done();\n});",null]}